<!doctype html>
<html>
  <head>
    <title>mouse-and-keyboard</title>
    <meta charset = 'utf-8'>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      body { overflow: hidden; }
    </style>
    <script type = 'text/javascript' src = './../../eng.js'></script>
  </head>
  <body>
    <script type = 'text/javascript'>
      
      cfg.debug = true;
      cfg.modulepath = './../../modules/';
      cfg.grid = 64;
      cfg.window.fps = 5;

      let gr;

      // назначение клавиш:
      Add.rule({
        w: 'up',
        a: 'left',
        s: 'down',
        d: 'right',


        space: 'action',
        e: 'action',

        left: 'left',
        up: 'up',
        down: 'down',
        right: 'right'
      })

      const canvas = Add.canvas(

        async function() { // загрузчик:

          // загрузка модулей:
          await Add.module('graphics', 'byte', 'math');

          gr = graphics.create(canvas.cvs);

          colors = [
            '#c846c8', '#fff096', '#78e6b4',
            '#f05064', '#ff8c64', '#6eb4ff'
          ];

          Add.debug('Загрузка завершена!');
        },

        function(t) { // игровой процесс:
          if (!gr) return;

          const w = canvas.id.width / cfg.pixel,
                h = canvas.id.height / cfg.pixel;

          gr.rect(0, 0, w, h, '#000');
          
          if (!bind) return;

          // отображение статуса нажатия кнопок:
          const x = 10, y = 10, 
                step = cfg.grid * .5;
          
          let i = 0;

          for (const key of Object.keys(bind.keys)) {
            gr.text.draw(`${key}: ${bind.check(key)}`, x, y + step * i++, '#fff', 1, cfg.grid * .5, undefined, 'left-top');
          }

          // пример нажатия на кнопку:
          let alpha = 1;
          if (math.collision.mouse.rect(w * .5, h * .75, cfg.grid) && !bind.check('hover')) {
            bind.add('hover');
            alpha = .6;

            // отпускание с кнопки:
            if (bind.check('uclick')) {

              Add.debug('На меня нажали!', 'uclick');

              bind.clear('uclick');
              // дальше обработка отпускания левой кнопки мыши
              // не будет работать пока игрок ее еще раз не нажмет
            }

            // нажатие на кнопку:
            if (bind.check('dclick')) {

              Add.debug('На меня нажали!', 'dclick');

              bind.clear('dclick');
              // дальше обработка отпускания левой кнопки мыши
              // не будет работать пока игрок ее еще раз не нажмет
            }
          }
          gr.rect(w * .5, h * .75, cfg.grid, cfg.grid, colors[~~((current_time * .01) % colors.length)], alpha);
        }

      );

      canvas.init();
      canvas.update();

    </script>
  </body>
</html>